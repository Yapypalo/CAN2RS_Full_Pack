/* ========================== uart.h ========================== */
#ifndef UART_H
#define UART_H

#include "stm32f1xx_hal.h"

extern UART_HandleTypeDef huart1;
extern DMA_HandleTypeDef hdma_usart1_rx;
extern DMA_HandleTypeDef hdma_usart1_tx;

/**
 * @brief Инициализация UART1 @1 000 000 baud, DMA RX/TX.
 *        RS-485: DE pin – PB6. При передаче устанавливать PB6=1, после TXCplt – PB6=0.
 */
void UART_Init(void);

/**
 * @brief Послать данные по RS-485.
 * @param buf   – указатель на буфер с данными
 * @param len   – длина в байтах
 */
void UART_Send(uint8_t *buf, uint16_t len);

/**
 * @brief Проверить, пришел ли полный пакет от датчика.
 * @return  true – данные готовы, false – нет.
 */
bool UART_PacketReady(void);

/**
 * @brief Получить указатель и длину принятого пакета.
 */
uint8_t* UART_GetRxBuf(uint16_t *out_len);

#endif // UART_H
